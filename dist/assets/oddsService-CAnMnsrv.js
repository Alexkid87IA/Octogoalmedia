const u={61:"ligue1",39:"premierleague",140:"laliga",135:"seriea",78:"bundesliga",2:"championsleague",3:"europaleague",62:"ligue2"};function C(e){return!e||e===0?"-":e.toFixed(2)}function T(e){return!e||e<=1?0:1/e*100}function x(e){const o=e.odds.winamax;if(!o)return null;const{home:t,draw:n,away:r}=o,c=Math.min(t,n,r);return c===t?"home":c===r?"away":"draw"}const h="/api/odds",m=30*60*1e3,O="octogoal_odds_";function g(e){return`${O}${e}`}function S(e){try{const o=g(e),t=localStorage.getItem(o);if(!t)return null;const n=JSON.parse(t),r=Date.now();if(r<n.expiresAt){const c=Math.round((n.expiresAt-r)/6e4);return console.log(`[OddsService] Cache localStorage HIT pour ${e} (expire dans ${c}min)`),n.data}return localStorage.removeItem(o),console.log(`[OddsService] Cache expiré pour ${e}`),null}catch(o){return console.error("[OddsService] Erreur lecture cache:",o),null}}function v(e,o){try{const t=g(e),n=Date.now(),r={data:o,timestamp:n,expiresAt:n+m};localStorage.setItem(t,JSON.stringify(r)),console.log(`[OddsService] Cache sauvegardé pour ${e} (30 min)`)}catch(t){console.error("[OddsService] Erreur sauvegarde cache:",t)}}const f=new Map;function p(e){const o=f.get(e);return o&&Date.now()<o.expiresAt?(console.log(`[OddsService] Cache mémoire HIT pour ${e}`),o.data):null}function $(e,o){f.set(e,{data:o,expiresAt:Date.now()+m})}async function y(e){const o=S(e);if(o)return o;const t=p(e);if(t)return t;try{console.log(`[OddsService] Fetching ${e} depuis l'API (consomme 1 requête)...`);const n=await fetch(`${h}?sport=${e}`);if(!n.ok)return console.error(`[OddsService] Erreur HTTP ${n.status}`),[];const r=await n.json();return!r.success||!r.data?(console.warn(`[OddsService] Pas de données pour ${e}`),[]):(r.quota&&console.log(`[OddsService] Quota: ${r.quota.used} utilisées, ${r.quota.remaining} restantes`),console.log(`[OddsService] ${r.count} matchs avec cotes Winamax`),v(e,r.data),$(e,r.data),r.data)}catch(n){return console.error(`[OddsService] Erreur fetch ${e}:`,n),[]}}async function w(e){const o=u[e];return o?(console.log(`[OddsService] Competition ${e} mapped to sport: ${o}`),y(o)):(console.warn(`[OddsService] Compétition ${e} non mappée - ID inconnu`),console.log("[OddsService] Compétitions supportées:",Object.keys(u).join(", ")),[])}async function A(e,o,t){console.log("[OddsService] findMatchOdds called:",{homeTeam:e,awayTeam:o,competitionId:t});const n=await w(t);if(console.log("[OddsService] allOdds count:",n.length),!n.length)return console.log("[OddsService] No odds found for competition",t),null;const r=a=>a.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]/g,""),c=r(e),s=r(o);console.log(`[OddsService] Searching for: "${e}" (${c}) vs "${o}" (${s})`);const i=n.find(a=>{const l=r(a.homeTeam),d=r(a.awayTeam);return!!(l===c&&d===s||(l.includes(c)||c.includes(l))&&(d.includes(s)||s.includes(d)))});return i?console.log("[OddsService] Match found:",i.homeTeam,"vs",i.awayTeam):console.log("[OddsService] No match found. Available matches:",n.slice(0,5).map(a=>`${a.homeTeam} vs ${a.awayTeam}`)),i||null}export{C as a,A as f,x as g,T as i};
