const u={61:"ligue1",39:"premierleague",140:"laliga",135:"seriea",78:"bundesliga",2:"championsleague",3:"europaleague",62:"ligue2"};function C(e){return!e||e===0?"-":e.toFixed(2)}function T(e){return!e||e<=1?0:1/e*100}function A(e){const o=e.odds.winamax;if(!o)return null;const{home:n,draw:r,away:t}=o,a=Math.min(n,r,t);return a===n?"home":a===t?"away":"draw"}const h="/api/odds",m=60*60*1e3,O="octogoal_odds_";function g(e){return`${O}${e}`}function S(e){try{const o=g(e),n=localStorage.getItem(o);if(!n)return null;const r=JSON.parse(n),t=Date.now();if(t<r.expiresAt){const a=Math.round((r.expiresAt-t)/6e4);return console.log(`[OddsService] Cache localStorage HIT pour ${e} (expire dans ${a}min)`),r.data}return localStorage.removeItem(o),console.log(`[OddsService] Cache expiré pour ${e}`),null}catch(o){return console.error("[OddsService] Erreur lecture cache:",o),null}}function v(e,o){try{const n=g(e),r=Date.now(),t={data:o,timestamp:r,expiresAt:r+m};localStorage.setItem(n,JSON.stringify(t)),console.log(`[OddsService] Cache sauvegardé pour ${e} (1h)`)}catch(n){console.error("[OddsService] Erreur sauvegarde cache:",n)}}const f=new Map;function p(e){const o=f.get(e);return o&&Date.now()<o.expiresAt?(console.log(`[OddsService] Cache mémoire HIT pour ${e}`),o.data):null}function $(e,o){f.set(e,{data:o,expiresAt:Date.now()+m})}async function w(e){const o=S(e);if(o)return o;const n=p(e);if(n)return n;try{console.log(`[OddsService] Fetching ${e} depuis l'API (consomme 1 requête)...`);const r=new AbortController,t=setTimeout(()=>r.abort(),5e3),a=await fetch(`${h}?sport=${e}`,{signal:r.signal});if(clearTimeout(t),!a.ok)return console.error(`[OddsService] Erreur HTTP ${a.status}`),[];const c=await a.json();return!c.success||!c.data?(console.warn(`[OddsService] Pas de données pour ${e}`),[]):(c.quota&&console.log(`[OddsService] Quota: ${c.quota.used} utilisées, ${c.quota.remaining} restantes`),console.log(`[OddsService] ${c.count} matchs avec cotes Winamax`),v(e,c.data),$(e,c.data),c.data)}catch(r){return r instanceof Error&&r.name==="AbortError"?console.error(`[OddsService] Timeout fetch ${e} (5s)`):console.error(`[OddsService] Erreur fetch ${e}:`,r),[]}}async function y(e){const o=u[e];return o?(console.log(`[OddsService] Competition ${e} mapped to sport: ${o}`),w(o)):(console.warn(`[OddsService] Compétition ${e} non mappée - ID inconnu`),console.log("[OddsService] Compétitions supportées:",Object.keys(u).join(", ")),[])}async function x(e,o,n){console.log("[OddsService] findMatchOdds called:",{homeTeam:e,awayTeam:o,competitionId:n});const r=await y(n);if(console.log("[OddsService] allOdds count:",r.length),!r.length)return console.log("[OddsService] No odds found for competition",n),null;const t=s=>s.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]/g,""),a=t(e),c=t(o);console.log(`[OddsService] Searching for: "${e}" (${a}) vs "${o}" (${c})`);const i=r.find(s=>{const l=t(s.homeTeam),d=t(s.awayTeam);return!!(l===a&&d===c||(l.includes(a)||a.includes(l))&&(d.includes(c)||c.includes(d)))});return i?console.log("[OddsService] Match found:",i.homeTeam,"vs",i.awayTeam):console.log("[OddsService] No match found. Available matches:",r.slice(0,5).map(s=>`${s.homeTeam} vs ${s.awayTeam}`)),i||null}export{u as C,A as a,x as b,C as f,w as g,T as i};
