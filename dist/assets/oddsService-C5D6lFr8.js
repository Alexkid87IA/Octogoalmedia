const g={61:"ligue1",39:"premierleague",140:"laliga",135:"seriea",78:"bundesliga",2:"championsleague",3:"europaleague",62:"ligue2"};function A(e){return!e||e===0?"-":e.toFixed(2)}function T(e){return!e||e<=1?0:1/e*100}function x(e){const o=e.odds.winamax;if(!o)return null;const{home:r,draw:t,away:c}=o,a=Math.min(r,t,c);return a===r?"home":a===c?"away":"draw"}const S="/api/odds",h=3600*1e3,v="octogoal_odds_";function O(e){return`${v}${e}`}function p(e){try{const o=O(e),r=localStorage.getItem(o);if(!r)return null;const t=JSON.parse(r),c=Date.now();if(c<t.expiresAt){const a=Math.round((t.expiresAt-c)/6e4);return console.log(`[OddsService] Cache localStorage HIT pour ${e} (expire dans ${a}min)`),t.data}return localStorage.removeItem(o),console.log(`[OddsService] Cache expiré pour ${e}`),null}catch(o){return console.error("[OddsService] Erreur lecture cache:",o),null}}function w(e,o){try{const r=O(e),t=Date.now(),c={data:o,timestamp:t,expiresAt:t+h};localStorage.setItem(r,JSON.stringify(c)),console.log(`[OddsService] Cache sauvegardé pour ${e} (1h)`)}catch(r){console.error("[OddsService] Erreur sauvegarde cache:",r)}}const l=new Map,m=new Map;function y(e){const o=l.get(e);return o&&Date.now()<o.expiresAt?o.data:null}function f(e,o){l.set(e,{data:o,expiresAt:Date.now()+h})}async function $(e){const o=p(e);if(o)return o;const r=y(e);if(r)return r;const t=m.get(e);if(t)return t;const c=(async()=>{try{console.log(`[OddsService] Fetching ${e} depuis l'API (consomme 1 requête)...`);const a=new AbortController,i=setTimeout(()=>a.abort(),5e3),s=await fetch(`${S}?sport=${e}`,{signal:a.signal});if(clearTimeout(i),!s.ok)return console.error(`[OddsService] Erreur HTTP ${s.status}`),f(e,[]),[];const n=await s.json();return!n.success||!n.data||n.data.length===0?(l.set(e,{data:[],expiresAt:Date.now()+300*1e3}),[]):(n.quota&&console.log(`[OddsService] Quota: ${n.quota.used} utilisées, ${n.quota.remaining} restantes`),console.log(`[OddsService] ${n.count} matchs avec cotes Winamax`),w(e,n.data),f(e,n.data),n.data)}catch(a){return a instanceof Error&&a.name==="AbortError"?console.error(`[OddsService] Timeout fetch ${e} (5s)`):console.error(`[OddsService] Erreur fetch ${e}:`,a),l.set(e,{data:[],expiresAt:Date.now()+120*1e3}),[]}finally{m.delete(e)}})();return m.set(e,c),c}async function C(e){const o=g[e];return o?(console.log(`[OddsService] Competition ${e} mapped to sport: ${o}`),$(o)):(console.warn(`[OddsService] Compétition ${e} non mappée - ID inconnu`),console.log("[OddsService] Compétitions supportées:",Object.keys(g).join(", ")),[])}async function E(e,o,r){console.log("[OddsService] findMatchOdds called:",{homeTeam:e,awayTeam:o,competitionId:r});const t=await C(r);if(console.log("[OddsService] allOdds count:",t.length),!t.length)return console.log("[OddsService] No odds found for competition",r),null;const c=n=>n.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]/g,""),a=c(e),i=c(o);console.log(`[OddsService] Searching for: "${e}" (${a}) vs "${o}" (${i})`);const s=t.find(n=>{const d=c(n.homeTeam),u=c(n.awayTeam);return!!(d===a&&u===i||(d.includes(a)||a.includes(d))&&(u.includes(i)||i.includes(u)))});return s?console.log("[OddsService] Match found:",s.homeTeam,"vs",s.awayTeam):console.log("[OddsService] No match found. Available matches:",t.slice(0,5).map(n=>`${n.homeTeam} vs ${n.awayTeam}`)),s||null}export{g as C,x as a,E as b,A as f,$ as g,T as i};
