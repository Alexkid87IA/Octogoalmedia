const g={61:"ligue1",39:"premierleague",140:"laliga",135:"seriea",78:"bundesliga",2:"championsleague",3:"europaleague",62:"ligue2"};function C(e){return!e||e===0?"-":e.toFixed(2)}function T(e){return!e||e<=1?0:1/e*100}function x(e){const r=e.odds.winamax;if(!r)return null;const{home:t,draw:n,away:o}=r,a=Math.min(t,n,o);return a===t?"home":a===o?"away":"draw"}const f="/api/odds",l=30*60*1e3,h="octogoal_odds_";function d(e){return`${h}${e}`}function O(e){try{const r=d(e),t=localStorage.getItem(r);if(!t)return null;const n=JSON.parse(t),o=Date.now();if(o<n.expiresAt){const a=Math.round((n.expiresAt-o)/6e4);return console.log(`[OddsService] Cache localStorage HIT pour ${e} (expire dans ${a}min)`),n.data}return localStorage.removeItem(r),console.log(`[OddsService] Cache expiré pour ${e}`),null}catch(r){return console.error("[OddsService] Erreur lecture cache:",r),null}}function S(e,r){try{const t=d(e),n=Date.now(),o={data:r,timestamp:n,expiresAt:n+l};localStorage.setItem(t,JSON.stringify(o)),console.log(`[OddsService] Cache sauvegardé pour ${e} (30 min)`)}catch(t){console.error("[OddsService] Erreur sauvegarde cache:",t)}}const m=new Map;function p(e){const r=m.get(e);return r&&Date.now()<r.expiresAt?(console.log(`[OddsService] Cache mémoire HIT pour ${e}`),r.data):null}function w(e,r){m.set(e,{data:r,expiresAt:Date.now()+l})}async function y(e){const r=O(e);if(r)return r;const t=p(e);if(t)return t;try{console.log(`[OddsService] Fetching ${e} depuis l'API (consomme 1 requête)...`);const n=await fetch(`${f}?sport=${e}`);if(!n.ok)return console.error(`[OddsService] Erreur HTTP ${n.status}`),[];const o=await n.json();return!o.success||!o.data?(console.warn(`[OddsService] Pas de données pour ${e}`),[]):(o.quota&&console.log(`[OddsService] Quota: ${o.quota.used} utilisées, ${o.quota.remaining} restantes`),console.log(`[OddsService] ${o.count} matchs avec cotes Winamax`),S(e,o.data),w(e,o.data),o.data)}catch(n){return console.error(`[OddsService] Erreur fetch ${e}:`,n),[]}}async function v(e){const r=g[e];return r?y(r):(console.warn(`[OddsService] Compétition ${e} non supportée pour les cotes`),[])}async function A(e,r,t){const n=await v(t);if(!n.length)return null;const o=c=>c.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]/g,""),a=o(e),s=o(r);return n.find(c=>{const i=o(c.homeTeam),u=o(c.awayTeam);return!!(i===a&&u===s||(i.includes(a)||a.includes(i))&&(u.includes(s)||s.includes(u)))})||null}export{C as a,A as f,x as g,T as i};
