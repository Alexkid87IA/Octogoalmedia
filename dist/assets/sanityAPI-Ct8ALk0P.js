import{M as c,s as i}from"./index-BKc32NQR.js";const l={},u=5*60*1e3;async function a(e,t){const o=Date.now(),r=l[e];if(r&&o-r.timestamp<u)return console.log(`Utilisation du cache pour ${e}`),r.data;try{const s=await t();return l[e]={data:s,timestamp:o},s}catch(s){throw console.error(`Erreur lors de la r√©cup√©ration des donn√©es pour ${e}:`,s),s}}const g=async()=>a("allArticles",async()=>{try{const t=await i.fetch(`*[_type == "article"] | order(publishedAt desc) {
        _id,
        title,
        slug,
        contentType,
        mainImage {
          asset->{
            _ref,
            _type,
            url
          },
          hotspot,
          crop
        },
        excerpt,
        publishedAt,
        keyPoints,
        readingTime,
        duration,
        videoUrl,
        guest,
        isEssential,
        isTrending,
        isFeatured,
        stats,
        categories[]->{
          _id,
          title,
          slug
        },
        subcategories[]->{
          _id,
          title,
          slug,
          parentCategory->{
            _id,
            title,
            slug
          }
        },
        author->{
          _id,
          name,
          "imageUrl": image.asset->url,
          image {
            asset->{
              _ref,
              _type,
              url
            },
            hotspot,
            crop
          },
          bio
        }
      }`);if(console.log(`Articles r√©cup√©r√©s: ${(t==null?void 0:t.length)||0}`),t&&t.length>0){const o=[...new Set(t.map(r=>r.contentType))];console.log("Types de contenu disponibles:",o),console.log("Premier article mainImage:",t[0].mainImage)}return t||[]}catch(e){return console.error("Erreur lors de la r√©cup√©ration des articles:",e),[]}}),p=async(e,t=!1)=>{if(console.log("üîç getArticleBySlug appel√© avec:",{slug:e,preview:t}),t)try{console.log("üîç Utilisation du previewClient"),console.log("üìä Configuration du previewClient:",{dataset:c.config().dataset,perspective:c.config().perspective,hasToken:!!c.config().token});const o=`*[_type == "article" && slug.current == $slug][0] {
        _id,
        _rev,
        _type,
        title,
        slug,
        contentType,
        mainImage {
          asset->{
            _ref,
            _type,
            url
          },
          hotspot,
          crop
        },
        body,
        excerpt,
        publishedAt,
        keyPoints,
        readingTime,
        duration,
        videoUrl,
        guest,
        isEssential,
        isTrending,
        isFeatured,
        stats,
        categories[]->{
          _id,
          title,
          slug
        },
        subcategories[]->{
          _id,
          title,
          slug,
          parentCategory->{
            _id,
            title,
            slug
          }
        },
        author->{
          _id,
          name,
          "imageUrl": image.asset->url,
          image {
            asset->{
              _ref,
              _type,
              url
            },
            hotspot,
            crop
          },
          bio
        }
      }`;console.log("üîç Ex√©cution de la requ√™te preview pour slug:",e),console.log("üîé Requ√™te GROQ:",o);const r=await c.fetch(o,{slug:e});if(console.log("‚úÖ R√©sultat de la requ√™te preview:",{found:!!r,id:r==null?void 0:r._id,title:r==null?void 0:r.title,contentType:r==null?void 0:r.contentType,keyPoints:r==null?void 0:r.keyPoints,isPublished:(r==null?void 0:r._id)&&!r._id.startsWith("drafts.")}),!r){console.log("‚ö†Ô∏è Aucun article trouv√©, recherche des brouillons...");const s=`*[_type == "article" && (_id match "drafts.*") && slug.current == $slug][0] {
          _id,
          _rev,
          _type,
          title,
          slug,
          contentType,
          mainImage {
            asset->{
              _ref,
              _type,
              url
            },
            hotspot,
            crop
          },
          body,
          excerpt,
          publishedAt,
          keyPoints,
          readingTime,
          duration,
          videoUrl,
          guest,
          isEssential,
          isTrending,
          isFeatured,
          stats,
          categories[]->{
            _id,
            title,
            slug
          },
          subcategories[]->{
            _id,
            title,
            slug,
            parentCategory->{
              _id,
              title,
              slug
            }
          },
          author->{
            _id,
            name,
            "imageUrl": image.asset->url,
            image {
              asset->{
                _ref,
                _type,
                url
              },
              hotspot,
              crop
            },
            bio
          }
        }`;console.log("üîé Requ√™te sp√©cifique brouillons:",s);const n=await c.fetch(s,{slug:e});return console.log("üìã R√©sultat recherche brouillons:",{found:!!n,id:n==null?void 0:n._id,contentType:n==null?void 0:n.contentType,keyPoints:n==null?void 0:n.keyPoints}),n}return r}catch(o){return console.error(`‚ùå Erreur lors de la r√©cup√©ration preview de l'article ${e}:`,o),console.error("D√©tails de l'erreur:",o),null}return console.log("üìö Utilisation du mode normal (avec cache)"),a(`article_${e}`,async()=>{var o;try{const s=await i.fetch(`*[_type == "article" && slug.current == $slug][0] {
        _id,
        title,
        slug,
        contentType,
        mainImage {
          asset->{
            _ref,
            _type,
            url
          },
          hotspot,
          crop
        },
        body,
        excerpt,
        publishedAt,
        keyPoints,
        readingTime,
        duration,
        videoUrl,
        guest,
        isEssential,
        isTrending,
        isFeatured,
        stats,
        categories[]->{
          _id,
          title,
          slug
        },
        subcategories[]->{
          _id,
          title,
          slug,
          parentCategory->{
            _id,
            title,
            slug
          }
        },
        author->{
          _id,
          name,
          "imageUrl": image.asset->url,
          image {
            asset->{
              _ref,
              _type,
              url
            },
            hotspot,
            crop
          },
          bio
        }
      }`,{slug:e});return console.log("üìã Article r√©cup√©r√© avec contentType:",s==null?void 0:s.contentType),console.log("üéØ Hotspot data:",(o=s==null?void 0:s.mainImage)==null?void 0:o.hotspot),s}catch(r){return console.error(`Erreur lors de la r√©cup√©ration de l'article ${e}:`,r),null}})},y=async e=>a(`articles_category_${e}`,async()=>{try{const o=await i.fetch('*[_type == "category" && slug.current == $categorySlug][0]._id',{categorySlug:e});if(!o)return console.log(`Cat√©gorie non trouv√©e pour le slug: ${e}`),[];const s=await i.fetch(`*[_type == "article" && references($categoryId)] | order(publishedAt desc) {
        _id,
        title,
        slug,
        contentType,
        mainImage {
          asset->{
            _ref,
            _type,
            url
          },
          hotspot,
          crop
        },
        excerpt,
        publishedAt,
        keyPoints,
        readingTime,
        duration,
        videoUrl,
        guest,
        isEssential,
        isTrending,
        isFeatured,
        stats,
        categories[]->{
          _id,
          title,
          slug
        },
        subcategories[]->{
          _id,
          title,
          slug,
          parentCategory->{
            _id,
            title,
            slug
          }
        }
      }`,{categoryId:o});return console.log(`Articles trouv√©s pour ${e}: ${s.length}`),s}catch(t){return console.error(`Erreur lors de la r√©cup√©ration des articles de la cat√©gorie ${e}:`,t),[]}}),_=async e=>a(`category_${e}`,async()=>{try{return await i.fetch(`*[_type == "category" && slug.current == $slug][0] {
        _id,
        title,
        slug,
        description
      }`,{slug:e})}catch(t){return console.error(`Erreur lors de la r√©cup√©ration de la cat√©gorie ${e}:`,t),null}}),h=async()=>a("featuredVSPoll",async()=>{try{return await i.fetch(`*[_type == "vsPoll" && featured == true && active == true] | order(publishedAt desc)[0] {
        _id,
        title,
        question,
        slug,
        option1 {
          name,
          subtitle,
          image {
            asset->{
              _ref,
              _type,
              url
            },
            hotspot,
            crop
          },
          color,
          votes
        },
        option2 {
          name,
          subtitle,
          image {
            asset->{
              _ref,
              _type,
              url
            },
            hotspot,
            crop
          },
          color,
          votes
        },
        context,
        featured,
        active,
        publishedAt,
        endsAt
      }`)}catch(e){return console.error("Erreur lors de la r√©cup√©ration du VS Poll √† la une:",e),null}}),m=async e=>a(`articles_subcategory_${e}`,async()=>{try{const o=await i.fetch('*[_type == "subcategory" && slug.current == $subcategorySlug][0]._id',{subcategorySlug:e});if(!o)return console.log(`Sous-cat√©gorie non trouv√©e pour le slug: ${e}`),[];const s=await i.fetch(`*[_type == "article" && references($subcategoryId)] | order(publishedAt desc) {
        _id,
        title,
        slug,
        contentType,
        mainImage {
          asset->{
            _ref,
            _type,
            url
          },
          hotspot,
          crop
        },
        excerpt,
        publishedAt,
        keyPoints,
        readingTime,
        duration,
        videoUrl,
        guest,
        isTrending,
        isFeatured,
        isEssential,
        stats,
        categories[]->{
          _id,
          title,
          slug
        },
        subcategories[]->{
          _id,
          title,
          slug,
          parentCategory->{
            _id,
            title,
            slug
          }
        }
      }`,{subcategoryId:o});return console.log(`Articles trouv√©s pour ${e}: ${s.length}`),s}catch(t){return console.error(`Erreur lors de la r√©cup√©ration des articles de la sous-cat√©gorie ${e}:`,t),[]}}),b=async e=>a(`subcategory_${e}`,async()=>{try{return await i.fetch(`*[_type == "subcategory" && slug.current == $slug][0] {
        _id,
        title,
        slug,
        description,
        parentCategory->{
          _id,
          title,
          slug
        }
      }`,{slug:e})}catch(t){return console.error(`Erreur lors de la r√©cup√©ration de la sous-cat√©gorie ${e}:`,t),null}}),f=async(e=50)=>a(`octogoalEmissions_${e}`,async()=>{try{const o=await i.fetch(`*[_type == "emission"] | order(episodeNumber desc)[0...$limit] {
        _id,
        title,
        "slug": slug.current,
        episodeNumber,
        youtubeUrl,
        "thumbnail": thumbnail.asset->url,
        duration,
        description,
        publishedAt,
        themes
      }`,{limit:e});return console.log(`√âmissions Octogoal r√©cup√©r√©es: ${(o==null?void 0:o.length)||0}`),o||[]}catch(t){return console.error("Erreur lors de la r√©cup√©ration des √©missions Octogoal:",t),[]}}),$=async()=>a("latestOctogoalEmission",async()=>{try{const t=await i.fetch(`*[_type == "emission"] | order(publishedAt desc)[0] {
        _id,
        title,
        "slug": slug.current,
        episodeNumber,
        youtubeUrl,
        "thumbnail": thumbnail.asset->url,
        duration,
        description,
        publishedAt,
        themes
      }`);return console.log("Derni√®re √©mission Octogoal:",(t==null?void 0:t.title)||"Aucune"),t}catch(e){return console.error("Erreur lors de la r√©cup√©ration de la derni√®re √©mission:",e),null}}),A=async(e=20)=>a(`octogoalExtraits_${e}`,async()=>{try{const o=await i.fetch(`*[_type == "extrait"] | order(publishedAt desc)[0...$limit] {
        _id,
        title,
        youtubeShortUrl,
        "thumbnail": thumbnail.asset->url,
        duration,
        publishedAt,
        emission->{
          _id,
          title,
          episodeNumber
        }
      }`,{limit:e});return console.log(`Extraits Octogoal r√©cup√©r√©s: ${(o==null?void 0:o.length)||0}`),o||[]}catch(t){return console.error("Erreur lors de la r√©cup√©ration des extraits:",t),[]}});export{A as a,h as b,y as c,_ as d,b as e,m as f,f as g,$ as h,g as i,p as j};
