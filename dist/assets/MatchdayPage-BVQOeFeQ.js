import{j as e}from"./sanity-Dli2Tcak.js";import{f as W,h as X,r as c,L as y}from"./react-vendor-BZT10b4B.js";import{k as Z,N as ee,K as S,q as te,c as se}from"./index-B832RcJ2.js";import{T as ae,I as ne,q as $,c as L,k as F,m as re,an as le}from"./ui-CXtmN_I9.js";function ie(){const n=new Date,h=n.getFullYear();return n.getMonth()<7?`${h-1}-${String(h).slice(-2)}`:`${h}-${String(h+1).slice(-2)}`}function ue(){const{leagueId:n}=W(),[h,f]=X(),D=h.get("matchday"),j=h.get("round"),[d,A]=c.useState([]),[_,H]=c.useState([]),[U,k]=c.useState(!0),[l,M]=c.useState(D?parseInt(D):1),[x,ce]=c.useState(j),i=n?Z(parseInt(n)):null,T=n?parseInt(n):0,B=[2,3,848],O=[1,4,6,9],w=B.includes(T),m=O.includes(T),g=x&&!x.includes("Regular Season"),Y=ie(),[r,q]=c.useState([]),[u,v]=c.useState(0),[J,I]=c.useState(!1);c.useEffect(()=>{async function s(){if(!(!n||!m)){I(!0);try{const t=await ee(n);if(console.log("[MatchdayPage] Available rounds for tournament:",t),t&&t.length>0){if(q(t),j){const a=t.indexOf(j);a>=0&&v(a)}}else console.warn("[MatchdayPage] No rounds found for tournament",n)}catch(t){console.error("Error fetching rounds:",t)}finally{I(!1)}}}s()},[n,m,j]),c.useEffect(()=>{async function s(){if(n){k(!0);try{let t=[];if(x&&g)console.log("[MatchdayPage] Fetching specific round:",x),t=await S(n,x);else if(m&&r.length>0){const o=r[u];console.log("[MatchdayPage] Fetching international tournament round:",o),t=await S(n,o)}else if(w){const o=`League Phase - ${l}`;console.log("[MatchdayPage] Fetching European cup round:",o),t=await S(n,o)}else t=await te(n,l);t.sort((o,p)=>new Date(o.utcDate).getTime()-new Date(p.utcDate).getTime()),A(t);const a=await se(n).catch(()=>[]);H(a||[])}catch(t){console.error("Error fetching matchday:",t)}finally{k(!1)}}}s()},[n,l,x,g,w,m,r,u]);const E=s=>{const t=s==="prev"?l-1:l+1;t>=1&&t<=((i==null?void 0:i.totalMatchdays)||38)&&(M(t),f({matchday:String(t)}))},P=s=>{const t=s==="prev"?u-1:u+1;t>=0&&t<r.length&&(v(t),f({round:r[t]}))},z=()=>m&&r.length>0?r[u]||"Phase de groupes":x,K=d.reduce((s,t)=>{const a=new Date(t.utcDate).toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long",year:"numeric"});return s[a]||(s[a]=[]),s[a].push(t),s},{}),R=s=>{const t=_.find(a=>a.team.id===s);return t==null?void 0:t.position},G=s=>new Date(s).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}),Q=s=>{switch(s.status){case"FINISHED":return{text:"Terminé",class:"bg-gray-600"};case"IN_PLAY":return{text:s.minute?`${s.minute}'`:"En cours",class:"bg-red-500 animate-pulse"};case"PAUSED":return{text:"Mi-temps",class:"bg-yellow-500"};case"SCHEDULED":case"TIMED":return{text:G(s.utcDate),class:"bg-blue-500"};default:return{text:s.status,class:"bg-gray-600"}}};return i?e.jsxs("div",{className:"min-h-screen bg-black",children:[e.jsx("div",{className:"fixed inset-0 pointer-events-none",children:e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(ellipse_at_top,rgba(236,72,153,0.15),transparent_50%)]"})}),e.jsx("header",{className:"relative pt-24 pb-6",children:e.jsxs("div",{className:"max-w-5xl mx-auto px-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs(y,{to:`/classements?league=${n}`,className:"inline-flex items-center gap-2 text-gray-400 hover:text-white transition-colors",children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsx("span",{children:i.name})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(y,{to:`/classements/scorers/${n}`,className:"text-sm text-pink-400 hover:text-pink-300 transition-colors",children:"Buteurs"}),e.jsx("span",{className:"text-gray-600",children:"•"}),e.jsx(y,{to:`/classements?league=${n}`,className:"text-sm text-pink-400 hover:text-pink-300 transition-colors",children:"Classement"})]})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("div",{className:`w-14 h-14 rounded-2xl bg-gradient-to-br ${i.color} flex items-center justify-center`,children:e.jsx("span",{className:"text-2xl",children:i.flag})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-black text-white",children:m&&r.length>0?z():g?x:w?`Journée ${l} - Phase de Ligue`:`Journée ${l}`}),e.jsxs("p",{className:"text-gray-400",children:[i.name," ",Y]})]})]}),m&&e.jsx("div",{className:"flex items-center justify-center gap-4 bg-gray-900/50 rounded-xl p-2 w-fit mx-auto",children:J?e.jsx("div",{className:"text-gray-400 px-4 py-2",children:"Chargement des tours..."}):r.length>0?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>P("prev"),disabled:u<=0,className:"p-2 rounded-lg hover:bg-white/10 disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:e.jsx($,{className:"w-5 h-5 text-white"})}),e.jsx("select",{value:u,onChange:s=>{const t=parseInt(s.target.value);v(t),f({round:r[t]})},className:"bg-gray-800 text-white px-4 py-2 rounded-lg border border-white/10 focus:border-pink-500 focus:outline-none min-w-[200px] text-center",children:r.map((s,t)=>e.jsx("option",{value:t,children:s},s))}),e.jsx("button",{onClick:()=>P("next"),disabled:u>=r.length-1,className:"p-2 rounded-lg hover:bg-white/10 disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:e.jsx(L,{className:"w-5 h-5 text-white"})})]}):e.jsx("div",{className:"text-gray-400 px-4 py-2",children:"Aucun tour disponible pour cette compétition"})}),!g&&!m&&e.jsxs("div",{className:"flex items-center justify-center gap-4 bg-gray-900/50 rounded-xl p-2 w-fit mx-auto",children:[e.jsx("button",{onClick:()=>E("prev"),disabled:l<=1,className:"p-2 rounded-lg hover:bg-white/10 disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:e.jsx($,{className:"w-5 h-5 text-white"})}),e.jsx("div",{className:"flex gap-1 overflow-x-auto scrollbar-hide px-2",children:Array.from({length:Math.min(i.totalMatchdays,15)},(s,t)=>{const a=Math.max(1,l-7)+t;return a>i.totalMatchdays?null:e.jsx("button",{onClick:()=>{M(a),f({matchday:String(a)})},className:`w-8 h-8 rounded-lg text-sm font-bold transition-all ${a===l?"bg-gradient-to-r from-pink-500 to-purple-500 text-white":"text-gray-400 hover:text-white hover:bg-white/10"}`,children:a},a)})}),e.jsx("button",{onClick:()=>E("next"),disabled:l>=i.totalMatchdays,className:"p-2 rounded-lg hover:bg-white/10 disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:e.jsx(L,{className:"w-5 h-5 text-white"})})]})]})}),e.jsxs("main",{className:"relative max-w-5xl mx-auto px-4 pb-12",children:[U?e.jsx("div",{className:"space-y-4",children:[...Array(8)].map((s,t)=>e.jsx("div",{className:"bg-gray-900/50 rounded-xl h-24 animate-pulse"},t))}):d.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(F,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"Aucun match trouvé"}),e.jsx("p",{className:"text-gray-400",children:"Les matchs de cette journée ne sont pas encore programmés."})]}):e.jsx("div",{className:"space-y-8",children:Object.entries(K).map(([s,t])=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(F,{className:"w-5 h-5 text-pink-500"}),e.jsx("h2",{className:"text-lg font-bold text-white capitalize",children:s}),e.jsxs("span",{className:"text-gray-500 text-sm",children:["(",t.length," matchs)"]})]}),e.jsx("div",{className:"space-y-2",children:t.map((a,o)=>{const p=Q(a),C=a.status==="IN_PLAY"||a.status==="PAUSED",V=a.status==="FINISHED",b=R(a.homeTeam.id),N=R(a.awayTeam.id);return e.jsx(re.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:o*.05},children:e.jsxs(y,{to:`/match/${a.id}`,className:`block bg-gray-900/50 hover:bg-gray-900/70 rounded-xl p-4 transition-all border ${C?"border-red-500/50 ring-1 ring-red-500/20":"border-transparent hover:border-white/10"}`,children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1 flex items-center gap-3 justify-end",children:[b&&!g&&e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded ${b<=4?"bg-blue-500/20 text-blue-400":b>=18?"bg-red-500/20 text-red-400":"bg-gray-700 text-gray-400"}`,children:[b,"e"]}),e.jsx("span",{className:"text-white font-semibold text-right truncate max-w-[150px] md:max-w-none",children:a.homeTeam.name}),e.jsx("img",{src:a.homeTeam.crest,alt:"",className:"w-10 h-10 object-contain flex-shrink-0"})]}),e.jsx("div",{className:"flex flex-col items-center min-w-[100px]",children:V||C?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl font-black text-white",children:a.score.fullTime.home??0}),e.jsx("span",{className:"text-gray-600",children:"-"}),e.jsx("span",{className:"text-2xl font-black text-white",children:a.score.fullTime.away??0})]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded mt-1 ${p.class} text-white`,children:p.text})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:`text-lg font-bold px-3 py-1 rounded ${p.class} text-white`,children:p.text}),e.jsx("span",{className:"text-gray-500 text-xs mt-1",children:new Date(a.utcDate).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})})]})}),e.jsxs("div",{className:"flex-1 flex items-center gap-3",children:[e.jsx("img",{src:a.awayTeam.crest,alt:"",className:"w-10 h-10 object-contain flex-shrink-0"}),e.jsx("span",{className:"text-white font-semibold truncate max-w-[150px] md:max-w-none",children:a.awayTeam.name}),N&&!g&&e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded ${N<=4?"bg-blue-500/20 text-blue-400":N>=18?"bg-red-500/20 text-red-400":"bg-gray-700 text-gray-400"}`,children:[N,"e"]})]})]}),a.venue&&e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-3 pt-3 border-t border-white/5",children:[e.jsx(le,{className:"w-3 h-3 text-gray-500"}),e.jsx("span",{className:"text-gray-500 text-xs",children:a.venue})]})]})},a.id)})})]},s))}),d.length>0&&e.jsxs("div",{className:"mt-8 grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gray-900/50 rounded-xl p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-black text-white",children:d.filter(s=>s.status==="FINISHED").length}),e.jsx("div",{className:"text-gray-400 text-sm",children:"Terminés"})]}),e.jsxs("div",{className:"bg-gray-900/50 rounded-xl p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-black text-white",children:d.filter(s=>s.status==="SCHEDULED"||s.status==="TIMED").length}),e.jsx("div",{className:"text-gray-400 text-sm",children:"À venir"})]}),e.jsxs("div",{className:"bg-gray-900/50 rounded-xl p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-black text-pink-400",children:d.reduce((s,t)=>s+(t.score.fullTime.home||0)+(t.score.fullTime.away||0),0)}),e.jsx("div",{className:"text-gray-400 text-sm",children:"Buts"})]}),e.jsxs("div",{className:"bg-gray-900/50 rounded-xl p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-black text-blue-400",children:(d.reduce((s,t)=>{const a=(t.score.fullTime.home||0)+(t.score.fullTime.away||0);return t.status==="FINISHED"?s+a:s},0)/Math.max(1,d.filter(s=>s.status==="FINISHED").length)).toFixed(1)}),e.jsx("div",{className:"text-gray-400 text-sm",children:"Buts/match"})]})]})]})]}):e.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ae,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"Compétition non trouvée"}),e.jsx(y,{to:"/classements",className:"text-pink-400 hover:underline",children:"Retour au football"})]})})}export{ue as default};
